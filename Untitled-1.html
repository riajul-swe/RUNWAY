<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Agency Data Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            margin: 0;
            padding: 0;
            display: flex;
        }
        
        .sidebar {
            width: 300px;
            background: #2c3e50;
            color: white;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #34495e;
        }
        
        .sidebar-header h3 {
            margin: 0;
            color: #ecf0f1;
        }
        
        .sidebar-menu {
            padding: 0;
            list-style: none;
            margin: 0;
        }
        
        .sidebar-menu li {
            border-bottom: 1px solid #34495e;
        }
        
        .sidebar-menu a {
            display: block;
            padding: 15px 20px;
            color: #bdc3c7;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: #34495e;
            color: #ecf0f1;
            padding-left: 25px;
        }
        
        .sidebar-menu i {
            margin-right: 10px;
            width: 20px;
        }
        
        .main-content {
            margin-left: 300px;
            flex: 1;
            padding: 20px;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 24px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            opacity: 0.9;
        }
        
        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            margin: 0;
        }
        
        .chart-container {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.3s ease;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .status-item {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }
        
        .status-item .label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .status-item .value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        h2 {
            text-align: center;
            margin-bottom: 24px;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .controls input, .controls select {
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            margin-right: 10px;
            margin-bottom: 8px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 6px 8px;
            text-align: left;
        }
        th {
            background: #f8f9fa;
            cursor: pointer;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background: #fafafa;
        }
        /* Removed color coding for minimal design */
        .action-btn {
            padding: 4px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin-right: 4px;
        }
        .edit-btn {
            background: #007bff;
            color: #fff;
        }
        .delete-btn {
            background: #dc3545;
            color: #fff;
        }
        .add-btn {
            background: #28a745;
            color: #fff;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h3>XAPP Admin</h3>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#" class="active" onclick="showSection('dashboard')"><i>üìä</i>Dashboard</a></li>
            <li><a href="#" onclick="showSection('table')"><i>üìã</i>Data Table</a></li>
            <li><a href="#" onclick="showSection('agent')"><i>üë§</i>Agent</a></li>
            <li><a href="#" onclick="showSection('agency')"><i>üè¢</i>Agency</a></li>
            <li><a href="#" onclick="showSection('medical')"><i>üè•</i>Medical</a></li>
            <li><a href="#" onclick="showSection('finger')"><i>üëÜ</i>Finger</a></li>
            <li><a href="#" onclick="showSection('mofa')"><i>üìú</i>MOFA</a></li>
            <li><a href="#" onclick="showSection('visa')"><i>üõÇ</i>Visa</a></li>
            <li><a href="#" onclick="showSection('manpower')"><i>üë∑</i>Manpower</a></li>
            <li><a href="#" onclick="showSection('flight')"><i>‚úàÔ∏è</i>Flight</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboardSection" class="dashboard-container">
            <h2>üìä Real-Time Agency Dashboard</h2>
            
            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Entries</h3>
                    <div class="number" id="totalEntries">0</div>
                </div>
                <div class="stat-card">
                    <h3>Medical FIT</h3>
                    <div class="number" id="medicalFit">0</div>
                </div>
                <div class="stat-card">
                    <h3>Visa OK</h3>
                    <div class="number" id="visaOk">0</div>
                </div>
                <div class="stat-card">
                    <h3>Flight OK</h3>
                    <div class="number" id="flightOk">0</div>
                </div>
            </div>
            
            <!-- Progress Charts -->
            <div class="chart-container">
                <div class="chart-title">üìà Progress Overview</div>
                <div class="status-grid">
                    <div class="status-item">
                        <div class="label">Medical Status</div>
                        <div class="value" id="medicalProgress">0%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="medicalBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="label">Visa Status</div>
                        <div class="value" id="visaProgress">0%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="visaBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="label">Flight Status</div>
                        <div class="value" id="flightProgress">0%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="flightBar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="chart-container">
                <div class="chart-title">üïí Recent Activity</div>
                <div id="recentActivity">
                    <p style="text-align: center; color: #666;">Loading recent activity...</p>
                </div>
            </div>
        </div>
        
        <!-- Table Section -->
        <div id="tableSection" class="dashboard-container" style="display: none;">
            <h2>üìã Data Table</h2>
            <div class="controls">
                <input type="text" id="searchInput" placeholder="Search by Name, Passport, or Agent">
                <select id="sortSelect">
                    <option value="">Sort By</option>
                    <option value="SL NO">SL NO</option>
                    <option value="NAME">NAME</option>
                    <option value="PASSPORT NO">PASSPORT NO</option>
                    <option value="AGENT">AGENT</option>
                    <option value="MEDICAL ">MEDICAL</option>
                    <option value="PC">PC</option>
                    <option value="MOFA">MOFA</option>
                    <option value="APPLICATION NO">APPLICATION NO</option>
                    <option value="FINGER">FINGER</option>
                    <option value="VISA ">VISA</option>
                    <option value=" MAN POWER">MAN POWER</option>
                    <option value="FLIGHT">FLIGHT</option>
                </select>
                <button class="add-btn" onclick="showAddForm()">Add New Entry</button>
                <button onclick="testJavaScript()" style="background: #ffc107; color: #000; padding: 6px 10px; border: none; border-radius: 4px; cursor: pointer;">Test JS</button>
                <button onclick="loadDataFromJSON()" style="background: #17a2b8; color: #fff; padding: 6px 10px; border: none; border-radius: 4px; cursor: pointer; margin-left: 8px;">üîÑ Reload</button>
                <button onclick="saveDataToJSON()" style="background: #6f42c1; color: #fff; padding: 6px 10px; border: none; border-radius: 4px; cursor: pointer; margin-left: 8px;">üíæ Save Data</button>
            </div>
            <table id="dataTable">
                <thead>
                    <tr>
                        <th onclick="sortTable('SL NO')">SL NO</th>
                        <th onclick="sortTable('NAME')">NAME</th>
                        <th onclick="sortTable('PASSPORT NO')">PASSPORT NO</th>
                        <th onclick="sortTable('AGENT')">AGENT</th>
                        <th onclick="sortTable('MEDICAL ')">MEDICAL</th>
                        <th onclick="sortTable('PC')">PC</th>
                        <th onclick="sortTable('MOFA')">MOFA</th>
                        <th onclick="sortTable('APPLICATION NO')">APPLICATION NO</th>
                        <th onclick="sortTable('FINGER')">FINGER</th>
                        <th onclick="sortTable('VISA ')">VISA</th>
                        <th onclick="sortTable(' MAN POWER')">MAN POWER</th>
                        <th onclick="sortTable('FLIGHT')">FLIGHT</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Data rows will be inserted here -->
                </tbody>
            </table>
        </div>
        
        <!-- Agent Section -->
        <div id="agentSection" class="dashboard-container" style="display: none;">
            <h2>üë§ Agent Management</h2>
            
            <!-- Agent Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Agents</h3>
                    <div class="number" id="totalAgents">0</div>
                </div>
                <div class="stat-card">
                    <h3>Active Agents</h3>
                    <div class="number" id="activeAgents">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Candidates</h3>
                    <div class="number" id="totalCandidates">0</div>
                </div>
                <div class="stat-card">
                    <h3>Success Rate</h3>
                    <div class="number" id="successRate">0%</div>
                </div>
            </div>
            
            <!-- Agent List -->
            <div class="chart-container">
                <div class="chart-title">üìã Agent List</div>
                <div id="agentList">
                    <p style="text-align: center; color: #666;">Loading agents...</p>
                </div>
            </div>
            
            <!-- Agent Details Modal -->
            <div id="agentModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); align-items:center; justify-content:center;">
                <div style="background:#fff; padding:24px; border-radius:8px; min-width:600px; max-height:80vh; overflow-y:auto; position:relative;">
                    <h3 id="agentModalTitle">Agent Details</h3>
                    <div id="agentDetails">
                        <!-- Agent details will be loaded here -->
                    </div>
                    <button onclick="closeAgentModal()" style="margin-top:16px; background: #6c757d; color: #fff; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Agency Section -->
        <div id="agencySection" class="dashboard-container" style="display: none;">
            <h2>üè¢ Agency Management</h2>
            
            <!-- Agency Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Agencies</h3>
                    <div class="number" id="totalAgencies">0</div>
                </div>
                <div class="stat-card">
                    <h3>Active Agencies</h3>
                    <div class="number" id="activeAgencies">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Candidates</h3>
                    <div class="number" id="agencyTotalCandidates">0</div>
                </div>
                <div class="stat-card">
                    <h3>Overall Success</h3>
                    <div class="number" id="agencySuccessRate">0%</div>
                </div>
            </div>
            
            <!-- Agency List -->
            <div class="chart-container">
                <div class="chart-title">üìã Agency List</div>
                <div id="agencyList">
                    <p style="text-align: center; color: #666;">Loading agencies...</p>
                </div>
            </div>
            
            <!-- Agency Details Modal -->
            <div id="agencyModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); align-items:center; justify-content:center;">
                <div style="background:#fff; padding:24px; border-radius:8px; min-width:700px; max-height:80vh; overflow-y:auto; position:relative;">
                    <h3 id="agencyModalTitle">Agency Details</h3>
                    <div id="agencyDetails">
                        <!-- Agency details will be loaded here -->
                    </div>
                    <button onclick="closeAgencyModal()" style="margin-top:16px; background: #6c757d; color: #fff; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Medical Section -->
        <div id="medicalSection" class="dashboard-container" style="display: none;">
            <h2>üè• Medical Status Management</h2>
            
            <!-- Medical Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Candidates</h3>
                    <div class="number" id="medicalTotalCandidates">0</div>
                </div>
                <div class="stat-card">
                    <h3>Medical FIT</h3>
                    <div class="number" id="medicalFitCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>Medical Pending</h3>
                    <div class="number" id="medicalPendingCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>Medical Unfit</h3>
                    <div class="number" id="medicalUnfitCount">0</div>
                </div>
            </div>
            
            <!-- Medical Status Chart -->
            <div class="chart-container">
                <div class="chart-title">üìä Medical Status Overview</div>
                <div id="medicalStatusChart">
                    <p style="text-align: center; color: #666;">Loading medical data...</p>
                </div>
            </div>
        </div>
        
        <!-- Finger Section -->
        <div id="fingerSection" class="dashboard-container" style="display: none;">
            <h2>üëÜ Finger Status Management</h2>
            
            <!-- Finger Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Candidates</h3>
                    <div class="number" id="fingerTotalCandidates">0</div>
                </div>
                <div class="stat-card">
                    <h3>Finger OK</h3>
                    <div class="number" id="fingerOkCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>Finger Pending</h3>
                    <div class="number" id="fingerPendingCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>Finger Rejected</h3>
                    <div class="number" id="fingerRejectedCount">0</div>
                </div>
            </div>
            
            <!-- Finger Status Chart -->
            <div class="chart-container">
                <div class="chart-title">üìä Finger Status Overview</div>
                <div id="fingerStatusChart">
                    <p style="text-align: center; color: #666;">Loading finger data...</p>
                </div>
            </div>
        </div>
        
        <!-- MOFA Section -->
        <div id="mofaSection" class="dashboard-container" style="display: none;">
            <h2>üìú MOFA Status Management</h2>
            
            <!-- MOFA Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Candidates</h3>
                    <div class="number" id="mofaTotalCandidates">0</div>
                </div>
                <div class="stat-card">
                    <h3>MOFA OK</h3>
                    <div class="number" id="mofaOkCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>MOFA Pending</h3>
                    <div class="number" id="mofaPendingCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>MOFA Rejected</h3>
                    <div class="number" id="mofaRejectedCount">0</div>
                </div>
            </div>
            
            <!-- MOFA Status Chart -->
            <div class="chart-container">
                <div class="chart-title">üìä MOFA Status Overview</div>
                <div id="mofaStatusChart">
                    <p style="text-align: center; color: #666;">Loading MOFA data...</p>
                </div>
            </div>
        </div>
        
        <!-- Visa Section -->
        <div id="visaSection" class="dashboard-container" style="display: none;">
            <h2>üõÇ Visa Status Management</h2>
            
            <!-- Visa Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Candidates</h3>
                    <div class="number" id="visaTotalCandidates">0</div>
                </div>
                <div class="stat-card">
                    <h3>Visa OK</h3>
                    <div class="number" id="visaOkCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>Visa Pending</h3>
                    <div class="number" id="visaPendingCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>Visa Rejected</h3>
                    <div class="number" id="visaRejectedCount">0</div>
                </div>
            </div>
            
            <!-- Visa Status Chart -->
            <div class="chart-container">
                <div class="chart-title">üìä Visa Status Overview</div>
                <div id="visaStatusChart">
                    <p style="text-align: center; color: #666;">Loading visa data...</p>
                </div>
            </div>
        </div>
        
        <!-- Manpower Section -->
        <div id="manpowerSection" class="dashboard-container" style="display: none;">
            <h2>üë∑ Manpower Status Management</h2>
            
            <!-- Manpower Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Candidates</h3>
                    <div class="number" id="manpowerTotalCandidates">0</div>
                </div>
                <div class="stat-card">
                    <h3>Manpower OK</h3>
                    <div class="number" id="manpowerOkCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>Manpower Pending</h3>
                    <div class="number" id="manpowerPendingCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>Manpower Rejected</h3>
                    <div class="number" id="manpowerRejectedCount">0</div>
                </div>
            </div>
            
            <!-- Manpower Status Chart -->
            <div class="chart-container">
                <div class="chart-title">üìä Manpower Status Overview</div>
                <div id="manpowerStatusChart">
                    <p style="text-align: center; color: #666;">Loading manpower data...</p>
                </div>
            </div>
        </div>
        
        <!-- Flight Section -->
        <div id="flightSection" class="dashboard-container" style="display: none;">
            <h2>‚úàÔ∏è Flight Status Management</h2>
            
            <!-- Flight Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Candidates</h3>
                    <div class="number" id="flightTotalCandidates">0</div>
                </div>
                <div class="stat-card">
                    <h3>Flight OK</h3>
                    <div class="number" id="flightOkCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>Flight Pending</h3>
                    <div class="number" id="flightPendingCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>Flight Rejected</h3>
                    <div class="number" id="flightRejectedCount">0</div>
                </div>
            </div>
            
            <!-- Flight Status Chart -->
            <div class="chart-container">
                <div class="chart-title">üìä Flight Status Overview</div>
                <div id="flightStatusChart">
                    <p style="text-align: center; color: #666;">Loading flight data...</p>
                </div>
            </div>
        </div>
        
        <!-- Add/Edit Form Modal -->
        <div id="formModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); align-items:center; justify-content:center;">
            <div style="background:#fff; padding:24px; border-radius:8px; min-width:300px; position:relative;">
                <h3 id="formTitle">Add Entry</h3>
                <form id="entryForm">
                    <input type="hidden" id="editIndex">
                    <div>
                        <label>SL NO:</label><br>
                        <input type="text" id="formSlno" required>
                    </div>
                    <div>
                        <label>NAME:</label><br>
                        <input type="text" id="formName" required>
                    </div>
                    <div>
                        <label>PASSPORT NO:</label><br>
                        <input type="text" id="formPassportno" required>
                    </div>
                    <div>
                        <label>AGENT:</label><br>
                        <input type="text" id="formAgent" required>
                    </div>
                    <div>
                        <label>MEDICAL:</label><br>
                        <input type="text" id="formMedical" required>
                    </div>
                    <div>
                        <label>PC:</label><br>
                        <input type="text" id="formPc" required>
                    </div>
                    <div>
                        <label>MOFA:</label><br>
                        <input type="text" id="formMofa" required>
                    </div>
                    <div>
                        <label>APPLICATION NO:</label><br>
                        <input type="text" id="formApplicationno" required>
                    </div>
                    <div>
                        <label>FINGER:</label><br>
                        <input type="text" id="formFinger" required>
                    </div>
                    <div>
                        <label>VISA:</label><br>
                        <input type="text" id="formVisa" required>
                    </div>
                    <div>
                        <label>MAN POWER:</label><br>
                        <input type="text" id="formManpower" required>
                    </div>
                    <div>
                        <label>FLIGHT:</label><br>
                        <input type="text" id="formFlight" required>
                    </div>
                    <div style="margin-top:16px;">
                        <button type="submit" class="add-btn">Save</button>
                        <button type="button" onclick="closeForm()" style="margin-left:8px;">Cancel</button>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Data will be loaded from JSON file
        let data = [];
        let dataFile = 'data.json';

        let currentSortColumn = '';
        let sortDirection = 'asc';

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard initialized!');
            renderTable();
            setupEventListeners();
        });

        // Fallback initialization if DOMContentLoaded doesn't fire
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeDashboard);
        } else {
            initializeDashboard();
        }

        // Test function to verify JavaScript is working
        function testJavaScript() {
            console.log('JavaScript is working!');
            alert('JavaScript is working!');
        }

        // Function to load data from JSON file
        async function loadDataFromJSON() {
            try {
                const response = await fetch(dataFile);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const jsonData = await response.json();
                // Your JSON is an array directly, not an object with entries property
                data = Array.isArray(jsonData) ? jsonData : [];
                console.log('Data loaded from JSON:', data);
                console.log('Total entries loaded:', data.length);
                renderTable();
                updateStats();
            } catch (error) {
                console.error('Error loading data:', error);
                // Fallback to sample data if JSON file not found
                data = [
                    { 'SL NO': "1", 'NAME': "Sample Entry", 'PASSPORT NO': "A123456", 'AGENT': "Sample Agency", 'MEDICAL ': "FIT", 'PC': "OK", 'MOFA': "OK", 'APPLICATION NO': "APP001", 'FINGER': "OK", 'VISA ': "OK", ' MAN POWER': "OK", 'FLIGHT': "OK" }
                ];
                renderTable();
            }
        }

        // Function to save data to JSON file
        async function saveDataToJSON() {
            try {
                // Save data as array directly to match your JSON structure
                const dataToSave = data;
                
                // Create a download link for the JSON file
                const dataStr = JSON.stringify(dataToSave, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = dataFile;
                link.click();
                
                URL.revokeObjectURL(url);
                console.log('Data saved to JSON file');
                alert('Data saved successfully! Check your downloads folder.');
            } catch (error) {
                console.error('Error saving data:', error);
                alert('Error saving data: ' + error.message);
            }
        }

        // Function to update statistics and dashboard
        function updateStats() {
            const totalEntries = data.length;
            const medicalFit = data.filter(entry => (entry['MEDICAL '] || '').toLowerCase() === 'fit').length;
            const visaOk = data.filter(entry => (entry['VISA '] || '').toLowerCase() === 'ok').length;
            const flightOk = data.filter(entry => (entry['FLIGHT'] || '').toLowerCase() === 'ok').length;
            
            // Update dashboard numbers
            document.getElementById('totalEntries').textContent = totalEntries;
            document.getElementById('medicalFit').textContent = medicalFit;
            document.getElementById('visaOk').textContent = visaOk;
            document.getElementById('flightOk').textContent = flightOk;
            
            // Calculate percentages
            const medicalPercent = totalEntries > 0 ? Math.round((medicalFit / totalEntries) * 100) : 0;
            const visaPercent = totalEntries > 0 ? Math.round((visaOk / totalEntries) * 100) : 0;
            const flightPercent = totalEntries > 0 ? Math.round((flightOk / totalEntries) * 100) : 0;
            
            // Update progress bars
            document.getElementById('medicalProgress').textContent = medicalPercent + '%';
            document.getElementById('medicalBar').style.width = medicalPercent + '%';
            document.getElementById('visaProgress').textContent = visaPercent + '%';
            document.getElementById('visaBar').style.width = visaPercent + '%';
            document.getElementById('flightProgress').textContent = flightPercent + '%';
            document.getElementById('flightBar').style.width = flightPercent + '%';
            
            // Update recent activity
            updateRecentActivity();
            
            console.log(`Total: ${totalEntries}, Medical FIT: ${medicalFit}, Visa OK: ${visaOk}, Flight OK: ${flightOk}`);
        }
        
        // Function to update recent activity
        function updateRecentActivity() {
            const recentActivity = document.getElementById('recentActivity');
            if (data.length === 0) {
                recentActivity.innerHTML = '<p style="text-align: center; color: #666;">No data available</p>';
                return;
            }
            
            // Get last 5 entries
            const recentEntries = data.slice(-5).reverse();
            let activityHTML = '';
            
            recentEntries.forEach((entry, index) => {
                const status = entry['MEDICAL '] || 'Pending';
                const statusColor = status.toLowerCase() === 'fit' ? '#28a745' : 
                                  status.toLowerCase() === 'unfit' ? '#dc3545' : '#ffc107';
                
                activityHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; ${index === recentEntries.length - 1 ? 'border-bottom: none;' : ''}">
                        <div>
                            <strong>${entry['NAME'] || 'Unknown'}</strong>
                            <br><small style="color: #666;">${entry['AGENT'] || 'No Agent'}</small>
                        </div>
                        <div style="color: ${statusColor}; font-weight: bold;">${status}</div>
                    </div>
                `;
            });
            
            recentActivity.innerHTML = activityHTML;
        }

        // Function to handle sidebar menu navigation
        function showSection(section) {
            console.log('Switching to section:', section);
            
            // Remove active class from all menu items
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Add active class to clicked menu item
            event.target.classList.add('active');
            
            // Hide all sections first
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('tableSection').style.display = 'none';
            document.getElementById('agentSection').style.display = 'none';
            document.getElementById('agencySection').style.display = 'none';
            document.getElementById('medicalSection').style.display = 'none';
            document.getElementById('fingerSection').style.display = 'none';
            document.getElementById('mofaSection').style.display = 'none';
            document.getElementById('visaSection').style.display = 'none';
            document.getElementById('manpowerSection').style.display = 'none';
            document.getElementById('flightSection').style.display = 'none';
            
            // Handle different sections
            switch(section) {
                case 'dashboard':
                    document.getElementById('dashboardSection').style.display = 'block';
                    console.log('Dashboard section shown');
                    break;
                case 'table':
                    document.getElementById('tableSection').style.display = 'block';
                    console.log('Table section shown');
                    break;
                case 'agent':
                    document.getElementById('agentSection').style.display = 'block';
                    loadAgentData();
                    console.log('Agent section shown');
                    break;
                case 'agency':
                    document.getElementById('agencySection').style.display = 'block';
                    loadAgencyData();
                    console.log('Agency section shown');
                    break;
                case 'medical':
                    document.getElementById('medicalSection').style.display = 'block';
                    loadMedicalData();
                    console.log('Medical section shown');
                    break;
                case 'finger':
                    document.getElementById('fingerSection').style.display = 'block';
                    loadFingerData();
                    console.log('Finger section shown');
                    break;
                case 'mofa':
                    document.getElementById('mofaSection').style.display = 'block';
                    loadMofaData();
                    console.log('MOFA section shown');
                    break;
                case 'visa':
                    document.getElementById('visaSection').style.display = 'block';
                    loadVisaData();
                    console.log('Visa section shown');
                    break;
                case 'manpower':
                    document.getElementById('manpowerSection').style.display = 'block';
                    loadManpowerData();
                    console.log('Manpower section shown');
                    break;
                case 'flight':
                    document.getElementById('flightSection').style.display = 'block';
                    loadFlightData();
                    console.log('Flight section shown');
                    break;
                default:
                    document.getElementById('dashboardSection').style.display = 'block';
            }
        }

        function initializeDashboard() {
            console.log('Initializing dashboard...');
            loadDataFromJSON(); // Load data from JSON file
            setupEventListeners();
        }

        function setupEventListeners() {
            console.log('Setting up event listeners...');
            
            const searchInput = document.getElementById('searchInput');
            const sortSelect = document.getElementById('sortSelect');
            const entryForm = document.getElementById('entryForm');
            
            if (searchInput) {
                searchInput.addEventListener('input', filterTable);
                console.log('Search input listener added');
            }
            
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    sortTable(this.value);
                });
                console.log('Sort select listener added');
            }
            
            if (entryForm) {
                entryForm.addEventListener('submit', handleFormSubmit);
                console.log('Form submit listener added');
            }
        }

        function renderTable() {
            console.log('Rendering table with', data.length, 'rows');
            console.log('First few rows:', data.slice(0, 3));
            
            const tbody = document.getElementById('tableBody');
            
            if (!tbody) {
                console.error('Table body not found!');
                return;
            }
            
            tbody.innerHTML = '';
            
            if (data.length === 0) {
                console.log('No data to display');
                tbody.innerHTML = '<tr><td colspan="13" style="text-align: center; padding: 20px;">No data available</td></tr>';
                return;
            }
            
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                // Removed color coding for minimal design
                
                console.log(`Creating row ${index} for entry:`, row);
                
                tr.innerHTML = `
                    <td>${row['SL NO'] || ''}</td>
                    <td>${row['NAME'] || ''}</td>
                    <td>${row['PASSPORT NO'] || ''}</td>
                    <td>${row['AGENT'] || ''}</td>
                    <td>${row['MEDICAL '] || ''}</td>
                    <td>${row['PC'] || ''}</td>
                    <td>${row['MOFA'] || ''}</td>
                    <td>${row['APPLICATION NO'] || ''}</td>
                    <td>${row['FINGER'] || ''}</td>
                    <td>${row['VISA '] || ''}</td>
                    <td>${row[' MAN POWER'] || ''}</td>
                    <td>${row['FLIGHT'] || ''}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editEntry(${index})" type="button">Edit</button>
                        <button class="action-btn delete-btn" onclick="deleteEntry(${index})" type="button">Delete</button>
                    </td>
                `;
                
                tbody.appendChild(tr);
                console.log(`Row ${index} added to table`);
            });
            
            console.log('Table rendered successfully');
        }

        // Removed getRowClass function for minimal design

        function filterTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#tableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function sortTable(column) {
            if (currentSortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                sortDirection = 'asc';
            }
            
            data.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                if (column === 'SL NO') {
                    aVal = parseInt(aVal) || 0;
                    bVal = parseInt(bVal) || 0;
                }
                
                if (sortDirection === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            renderTable();
        }

        function showAddForm() {
            document.getElementById('formTitle').textContent = 'Add Entry';
            document.getElementById('editIndex').value = '';
            document.getElementById('entryForm').reset();
            document.getElementById('formModal').style.display = 'flex';
        }

        function editEntry(index) {
            console.log('Edit entry called with index:', index);
            const entry = data[index];
            console.log('Entry to edit:', entry);
            
            if (!entry) {
                console.error('No entry found at index:', index);
                return;
            }
            
            document.getElementById('formTitle').textContent = 'Edit Entry';
            document.getElementById('editIndex').value = index;
            document.getElementById('formSlno').value = entry['SL NO'] || '';
            document.getElementById('formName').value = entry['NAME'] || '';
            document.getElementById('formPassportno').value = entry['PASSPORT NO'] || '';
            document.getElementById('formAgent').value = entry['AGENT'] || '';
            document.getElementById('formMedical').value = entry['MEDICAL '] || '';
            document.getElementById('formPc').value = entry['PC'] || '';
            document.getElementById('formMofa').value = entry['MOFA'] || '';
            document.getElementById('formApplicationno').value = entry['APPLICATION NO'] || '';
            document.getElementById('formFinger').value = entry['FINGER'] || '';
            document.getElementById('formVisa').value = entry['VISA '] || '';
            document.getElementById('formManpower').value = entry[' MAN POWER'] || '';
            document.getElementById('formFlight').value = entry['FLIGHT'] || '';
            document.getElementById('formModal').style.display = 'flex';
            console.log('Edit form opened successfully');
        }

        function closeForm() {
            document.getElementById('formModal').style.display = 'none';
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            
            const editIndex = document.getElementById('editIndex').value;
            const newEntry = {
                'SL NO': document.getElementById('formSlno').value,
                'NAME': document.getElementById('formName').value,
                'PASSPORT NO': document.getElementById('formPassportno').value,
                'AGENT': document.getElementById('formAgent').value,
                'MEDICAL ': document.getElementById('formMedical').value,
                'PC': document.getElementById('formPc').value,
                'MOFA': document.getElementById('formMofa').value,
                'APPLICATION NO': document.getElementById('formApplicationno').value,
                'FINGER': document.getElementById('formFinger').value,
                'VISA ': document.getElementById('formVisa').value,
                ' MAN POWER': document.getElementById('formManpower').value,
                'FLIGHT': document.getElementById('formFlight').value
            };
            
            if (editIndex === '') {
                // Add new entry
                data.push(newEntry);
            } else {
                // Edit existing entry
                data[parseInt(editIndex)] = newEntry;
            }
            
            renderTable();
            closeForm();
        }

        function deleteEntry(index) {
            console.log('Delete entry called with index:', index);
            console.log('Current data length:', data.length);
            
            if (index < 0 || index >= data.length) {
                console.error('Invalid index for deletion:', index);
                return;
            }
            
            if (confirm('Are you sure you want to delete this entry?')) {
                const deletedEntry = data[index];
                console.log('Deleting entry:', deletedEntry);
                data.splice(index, 1);
                console.log('Entry deleted. New data length:', data.length);
                renderTable();
            }
        }
        
        // Agent Management Functions
        function loadAgentData() {
            if (data.length === 0) {
                document.getElementById('agentList').innerHTML = '<p style="text-align: center; color: #666;">No data available</p>';
                return;
            }
            
            // Extract unique agents
            const agents = {};
            data.forEach(entry => {
                const agentName = entry['AGENT'] || 'Unknown';
                if (!agents[agentName]) {
                    agents[agentName] = {
                        name: agentName,
                        candidates: [],
                        medicalFit: 0,
                        visaOk: 0,
                        flightOk: 0,
                        total: 0
                    };
                }
                
                agents[agentName].candidates.push(entry);
                agents[agentName].total++;
                
                if ((entry['MEDICAL '] || '').toLowerCase() === 'fit') {
                    agents[agentName].medicalFit++;
                }
                if ((entry['VISA '] || '').toLowerCase() === 'ok') {
                    agents[agentName].visaOk++;
                }
                if ((entry['FLIGHT'] || '').toLowerCase() === 'ok') {
                    agents[agentName].flightOk++;
                }
            });
            
            // Update agent statistics
            const agentList = Object.values(agents);
            document.getElementById('totalAgents').textContent = agentList.length;
            document.getElementById('totalCandidates').textContent = data.length;
            
            // Calculate success rate (medical fit + visa ok + flight ok) / (total * 3)
            const totalPossible = data.length * 3;
            const totalSuccess = data.filter(entry => 
                (entry['MEDICAL '] || '').toLowerCase() === 'fit' &&
                (entry['VISA '] || '').toLowerCase() === 'ok' &&
                (entry['FLIGHT'] || '').toLowerCase() === 'ok'
            ).length;
            const successRate = totalPossible > 0 ? Math.round((totalSuccess / data.length) * 100) : 0;
            document.getElementById('successRate').textContent = successRate + '%';
            
            // Display agent list
            displayAgentList(agentList);
        }
        
        function displayAgentList(agents) {
            const agentListDiv = document.getElementById('agentList');
            let html = '';
            
            agents.forEach(agent => {
                const successPercent = agent.total > 0 ? Math.round((agent.medicalFit + agent.visaOk + agent.flightOk) / (agent.total * 3) * 100) : 0;
                const statusColor = successPercent >= 70 ? '#28a745' : successPercent >= 40 ? '#ffc107' : '#dc3545';
                
                html += `
                    <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 15px; background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #333;">${agent.name}</h3>
                            <button onclick="showAgentDetails('${agent.name}')" style="background: #007bff; color: #fff; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">View Details</button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #333;">${agent.total}</div>
                                <div style="font-size: 14px; color: #666;">Total Candidates</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #28a745;">${agent.medicalFit}</div>
                                <div style="font-size: 14px; color: #666;">Medical FIT</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #007bff;">${agent.visaOk}</div>
                                <div style="font-size: 14px; color: #666;">Visa OK</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #6f42c1;">${agent.flightOk}</div>
                                <div style="font-size: 14px; color: #666;">Flight OK</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: ${statusColor};">${successPercent}%</div>
                                <div style="font-size: 14px; color: #666;">Success Rate</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            agentListDiv.innerHTML = html;
        }
        
        function showAgentDetails(agentName) {
            const agentData = data.filter(entry => (entry['AGENT'] || '') === agentName);
            const modal = document.getElementById('agentModal');
            const detailsDiv = document.getElementById('agentDetails');
            
            let html = `
                <h4 style="margin-bottom: 20px; color: #333;">${agentName} - Candidate Details</h4>
                <div style="max-height: 400px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">SL NO</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">NAME</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">PASSPORT</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">MEDICAL</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">VISA</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">FLIGHT</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            agentData.forEach(entry => {
                const medicalStatus = entry['MEDICAL '] || '';
                const visaStatus = entry['VISA '] || '';
                const flightStatus = entry['FLIGHT'] || '';
                
                const medicalColor = medicalStatus.toLowerCase() === 'fit' ? '#28a745' : medicalStatus.toLowerCase() === 'unfit' ? '#dc3545' : '#ffc107';
                const visaColor = visaStatus.toLowerCase() === 'ok' ? '#28a745' : '#ffc107';
                const flightColor = flightStatus.toLowerCase() === 'ok' ? '#28a745' : '#ffc107';
                
                html += `
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">${entry['SL NO'] || ''}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${entry['NAME'] || ''}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${entry['PASSPORT NO'] || ''}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; color: ${medicalColor}; font-weight: bold;">${medicalStatus}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; color: ${visaColor}; font-weight: bold;">${visaStatus}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; color: ${flightColor}; font-weight: bold;">${flightStatus}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            detailsDiv.innerHTML = html;
            modal.style.display = 'flex';
        }
        
        function closeAgentModal() {
            document.getElementById('agentModal').style.display = 'none';
        }
        
        // Agency Management Functions
        function loadAgencyData() {
            if (data.length === 0) {
                document.getElementById('agencyList').innerHTML = '<p style="text-align: center; color: #666;">No data available</p>';
                return;
            }
            
            // Extract unique agencies from agent names (assuming agency is part of agent name)
            const agencies = {};
            data.forEach(entry => {
                const agentName = entry['AGENT'] || 'Unknown';
                // Extract agency name (first part before slash or space)
                const agencyName = agentName.split(/[\/\s]/)[0] || agentName;
                
                if (!agencies[agencyName]) {
                    agencies[agencyName] = {
                        name: agencyName,
                        agents: new Set(),
                        candidates: [],
                        medicalFit: 0,
                        visaOk: 0,
                        flightOk: 0,
                        total: 0
                    };
                }
                
                agencies[agencyName].agents.add(agentName);
                agencies[agencyName].candidates.push(entry);
                agencies[agencyName].total++;
                
                if ((entry['MEDICAL '] || '').toLowerCase() === 'fit') {
                    agencies[agencyName].medicalFit++;
                }
                if ((entry['VISA '] || '').toLowerCase() === 'ok') {
                    agencies[agencyName].visaOk++;
                }
                if ((entry['FLIGHT'] || '').toLowerCase() === 'ok') {
                    agencies[agencyName].flightOk++;
                }
            });
            
            // Update agency statistics
            const agencyList = Object.values(agencies);
            document.getElementById('totalAgencies').textContent = agencyList.length;
            document.getElementById('agencyTotalCandidates').textContent = data.length;
            
            // Calculate active agencies (those with candidates)
            const activeAgencies = agencyList.filter(agency => agency.total > 0).length;
            document.getElementById('activeAgencies').textContent = activeAgencies;
            
            // Calculate overall success rate
            const totalPossible = data.length * 3;
            const totalSuccess = data.filter(entry => 
                (entry['MEDICAL '] || '').toLowerCase() === 'fit' &&
                (entry['VISA '] || '').toLowerCase() === 'ok' &&
                (entry['FLIGHT'] || '').toLowerCase() === 'ok'
            ).length;
            const successRate = totalPossible > 0 ? Math.round((totalSuccess / data.length) * 100) : 0;
            document.getElementById('agencySuccessRate').textContent = successRate + '%';
            
            // Display agency list
            displayAgencyList(agencyList);
        }
        
        function displayAgencyList(agencies) {
            const agencyListDiv = document.getElementById('agencyList');
            let html = '';
            
            agencies.forEach(agency => {
                const successPercent = agency.total > 0 ? Math.round((agency.medicalFit + agency.visaOk + agency.flightOk) / (agency.total * 3) * 100) : 0;
                const statusColor = successPercent >= 70 ? '#28a745' : successPercent >= 40 ? '#ffc107' : '#dc3545';
                const agentCount = agency.agents.size;
                
                html += `
                    <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 15px; background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #333;">${agency.name}</h3>
                            <button onclick="showAgencyDetails('${agency.name}')" style="background: #007bff; color: #fff; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">View Details</button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #333;">${agency.total}</div>
                                <div style="font-size: 14px; color: #666;">Total Candidates</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #17a2b8;">${agentCount}</div>
                                <div style="font-size: 14px; color: #666;">Agents</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #28a745;">${agency.medicalFit}</div>
                                <div style="font-size: 14px; color: #666;">Medical FIT</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #007bff;">${agency.visaOk}</div>
                                <div style="font-size: 14px; color: #666;">Visa OK</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #6f42c1;">${agency.flightOk}</div>
                                <div style="font-size: 14px; color: #666;">Flight OK</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: ${statusColor};">${successPercent}%</div>
                                <div style="font-size: 14px; color: #666;">Success Rate</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            agencyListDiv.innerHTML = html;
        }
        
        function showAgencyDetails(agencyName) {
            const agencyData = data.filter(entry => {
                const agentName = entry['AGENT'] || '';
                return agentName.split(/[\/\s]/)[0] === agencyName;
            });
            
            const modal = document.getElementById('agencyModal');
            const detailsDiv = document.getElementById('agencyDetails');
            
            // Get unique agents for this agency
            const agents = [...new Set(agencyData.map(entry => entry['AGENT'] || ''))];
            
            let html = `
                <h4 style="margin-bottom: 20px; color: #333;">${agencyName} - Agency Overview</h4>
                
                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                    <h5 style="margin: 0 0 10px 0; color: #333;">Agents: ${agents.join(', ')}</h5>
                    <p style="margin: 0; color: #666;">Total Candidates: ${agencyData.length}</p>
                </div>
                
                <h5 style="margin-bottom: 15px; color: #333;">Candidate Details</h5>
                <div style="max-height: 400px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">SL NO</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">NAME</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">AGENT</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">PASSPORT</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">MEDICAL</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">VISA</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">FLIGHT</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            agencyData.forEach(entry => {
                const medicalStatus = entry['MEDICAL '] || '';
                const visaStatus = entry['VISA '] || '';
                const flightStatus = entry['FLIGHT'] || '';
                
                const medicalColor = medicalStatus.toLowerCase() === 'fit' ? '#28a745' : medicalStatus.toLowerCase() === 'unfit' ? '#dc3545' : '#ffc107';
                const visaColor = visaStatus.toLowerCase() === 'ok' ? '#28a745' : '#ffc107';
                const flightColor = flightStatus.toLowerCase() === 'ok' ? '#28a745' : '#ffc107';
                
                html += `
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">${entry['SL NO'] || ''}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${entry['NAME'] || ''}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${entry['AGENT'] || ''}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${entry['PASSPORT NO'] || ''}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; color: ${medicalColor}; font-weight: bold;">${medicalStatus}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; color: ${visaColor}; font-weight: bold;">${visaStatus}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; color: ${flightColor}; font-weight: bold;">${flightStatus}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            detailsDiv.innerHTML = html;
            modal.style.display = 'flex';
        }
        
        function closeAgencyModal() {
            document.getElementById('agencyModal').style.display = 'none';
        }
        
        // Medical Status Management Functions
        function loadMedicalData() {
            if (data.length === 0) {
                document.getElementById('medicalStatusChart').innerHTML = '<p style="text-align: center; color: #666;">No data available</p>';
                return;
            }
            
            const totalCandidates = data.length;
            const medicalFit = data.filter(entry => (entry['MEDICAL '] || '').toLowerCase() === 'fit').length;
            const medicalPending = data.filter(entry => (entry['MEDICAL '] || '').toLowerCase() === 'pending').length;
            const medicalUnfit = data.filter(entry => (entry['MEDICAL '] || '').toLowerCase() === 'unfit').length;
            const medicalOther = totalCandidates - medicalFit - medicalPending - medicalUnfit;
            
            // Update statistics
            document.getElementById('medicalTotalCandidates').textContent = totalCandidates;
            document.getElementById('medicalFitCount').textContent = medicalFit;
            document.getElementById('medicalPendingCount').textContent = medicalPending;
            document.getElementById('medicalUnfitCount').textContent = medicalUnfit;
            
            // Get all entries where Medical is NOT FIT
            const nonFitEntries = data.filter(entry => (entry['MEDICAL '] || '').toLowerCase() !== 'fit');
            
            // Create chart and list
            const chartDiv = document.getElementById('medicalStatusChart');
            chartDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="text-align: center; padding: 20px; background: #28a745; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${medicalFit}</h3>
                        <p style="margin: 5px 0 0 0;">FIT</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #ffc107; color: #333; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${medicalPending}</h3>
                        <p style="margin: 5px 0 0 0;">PENDING</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #dc3545; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${medicalUnfit}</h3>
                        <p style="margin: 5px 0 0 0;">UNFIT</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #6c757d; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${medicalOther}</h3>
                        <p style="margin: 5px 0 0 0;">OTHER</p>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px; color: #333;">üìã Candidates with Non-FIT Medical Status (${nonFitEntries.length})</h3>
                    ${nonFitEntries.length === 0 ? 
                        '<p style="text-align: center; color: #28a745; font-weight: bold;">üéâ All candidates are Medical FIT!</p>' :
                        `<div style="max-height: 400px; overflow-y: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                                <thead>
                                    <tr style="background: #f8f9fa;">
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">SL NO</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">NAME</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">PASSPORT</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">AGENT</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">MEDICAL STATUS</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">VISA</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">FLIGHT</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${nonFitEntries.map(entry => {
                                        const medicalStatus = entry['MEDICAL '] || '';
                                        const statusColor = medicalStatus.toLowerCase() === 'pending' ? '#ffc107' : 
                                                          medicalStatus.toLowerCase() === 'unfit' ? '#dc3545' : '#6c757d';
                                        const visaStatus = entry['VISA '] || '';
                                        const flightStatus = entry['FLIGHT'] || '';
                                        
                                        return `
                                            <tr>
                                                <td style="border: 1px solid #ddd; padding: 8px;">${entry['SL NO'] || ''}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px;">${entry['NAME'] || ''}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px;">${entry['PASSPORT NO'] || ''}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px;">${entry['AGENT'] || ''}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px; color: ${statusColor}; font-weight: bold;">${medicalStatus}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px;">${visaStatus}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px;">${flightStatus}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>`
                    }
                </div>
            `;
        }
        
        // Finger Status Management Functions
        function loadFingerData() {
            if (data.length === 0) {
                document.getElementById('fingerStatusChart').innerHTML = '<p style="text-align: center; color: #666;">No data available</p>';
                return;
            }
            
            const totalCandidates = data.length;
            const fingerOk = data.filter(entry => (entry['FINGER'] || '').toLowerCase() === 'ok').length;
            const fingerPending = data.filter(entry => (entry['FINGER'] || '').toLowerCase() === 'pending').length;
            const fingerRejected = data.filter(entry => (entry['FINGER'] || '').toLowerCase() === 'rejected').length;
            const fingerOther = totalCandidates - fingerOk - fingerPending - fingerRejected;
            
            // Update statistics
            document.getElementById('fingerTotalCandidates').textContent = totalCandidates;
            document.getElementById('fingerOkCount').textContent = fingerOk;
            document.getElementById('fingerPendingCount').textContent = fingerPending;
            document.getElementById('fingerRejectedCount').textContent = fingerRejected;
            
            // Get candidates ready for fingerprinting (Medical FIT + MOFA OK + Finger NOT OK)
            const readyForFinger = data.filter(entry => {
                const medicalStatus = (entry['MEDICAL '] || '').toLowerCase();
                const mofaStatus = (entry['MOFA'] || '').toLowerCase();
                const fingerStatus = (entry['FINGER'] || '').toLowerCase();
                
                return medicalStatus === 'fit' && 
                       mofaStatus === 'ok' && 
                       fingerStatus !== 'ok';
            });
            
            // Create chart and list
            const chartDiv = document.getElementById('fingerStatusChart');
            chartDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="text-align: center; padding: 20px; background: #28a745; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${fingerOk}</h3>
                        <p style="margin: 5px 0 0 0;">OK</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #ffc107; color: #333; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${fingerPending}</h3>
                        <p style="margin: 5px 0 0 0;">PENDING</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #dc3545; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${fingerRejected}</h3>
                        <p style="margin: 5px 0 0 0;">REJECTED</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #6c757d; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${fingerOther}</h3>
                        <p style="margin: 5px 0 0 0;">OTHER</p>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px; color: #333;">üìã Candidates Ready for Fingerprinting (${readyForFinger.length})</h3>
                    <p style="margin-bottom: 20px; color: #666; font-style: italic;">These candidates have Medical FIT + MOFA OK but Finger status is NOT OK</p>
                    
                    ${readyForFinger.length === 0 ? 
                        '<p style="text-align: center; color: #28a745; font-weight: bold;">üéâ All eligible candidates have completed fingerprinting!</p>' :
                        `<div style="max-height: 400px; overflow-y: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                                <thead>
                                    <tr style="background: #f8f9fa;">
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">SL NO</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">NAME</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">PASSPORT</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">AGENT</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">MEDICAL</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">MOFA</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">FINGER STATUS</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">VISA</th>
                                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">FLIGHT</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${readyForFinger.map(entry => {
                                        const fingerStatus = entry['FINGER'] || '';
                                        const statusColor = fingerStatus.toLowerCase() === 'pending' ? '#ffc107' : 
                                                          fingerStatus.toLowerCase() === 'rejected' ? '#dc3545' : '#6c757d';
                                        const visaStatus = entry['VISA '] || '';
                                        const flightStatus = entry['FLIGHT'] || '';
                                        
                                        return `
                                            <tr>
                                                <td style="border: 1px solid #ddd; padding: 8px;">${entry['SL NO'] || ''}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px;">${entry['NAME'] || ''}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px;">${entry['PASSPORT NO'] || ''}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px;">${entry['AGENT'] || ''}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px; color: #28a745; font-weight: bold;">${entry['MEDICAL '] || ''}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px; color: #28a745; font-weight: bold;">${entry['MOFA'] || ''}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px; color: ${statusColor}; font-weight: bold;">${fingerStatus}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px;">${visaStatus}</td>
                                                <td style="border: 1px solid #ddd; padding: 8px;">${flightStatus}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>`
                    }
                </div>
            `;
        }
        
        // MOFA Status Management Functions
        function loadMofaData() {
            if (data.length === 0) {
                document.getElementById('mofaStatusChart').innerHTML = '<p style="text-align: center; color: #666;">No data available</p>';
                return;
            }
            
            const totalCandidates = data.length;
            const mofaOk = data.filter(entry => (entry['MOFA'] || '').toLowerCase() === 'ok').length;
            const mofaPending = data.filter(entry => (entry['MOFA'] || '').toLowerCase() === 'pending').length;
            const mofaRejected = data.filter(entry => (entry['MOFA'] || '').toLowerCase() === 'rejected').length;
            const mofaOther = totalCandidates - mofaOk - mofaPending - mofaRejected;
            
            // Update statistics
            document.getElementById('mofaTotalCandidates').textContent = totalCandidates;
            document.getElementById('mofaOkCount').textContent = mofaOk;
            document.getElementById('mofaPendingCount').textContent = mofaPending;
            document.getElementById('mofaRejectedCount').textContent = mofaRejected;
            
            // Create chart
            const chartDiv = document.getElementById('mofaStatusChart');
            chartDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: #28a745; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${mofaOk}</h3>
                        <p style="margin: 5px 0 0 0;">OK</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #ffc107; color: #333; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${mofaPending}</h3>
                        <p style="margin: 5px 0 0 0;">PENDING</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #dc3545; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${mofaRejected}</h3>
                        <p style="margin: 5px 0 0 0;">REJECTED</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #6c757d; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${mofaOther}</h3>
                        <p style="margin: 5px 0 0 0;">OTHER</p>
                    </div>
                </div>
            `;
        }
        
        // Visa Status Management Functions
        function loadVisaData() {
            if (data.length === 0) {
                document.getElementById('visaStatusChart').innerHTML = '<p style="text-align: center; color: #666;">No data available</p>';
                return;
            }
            
            const totalCandidates = data.length;
            const visaOk = data.filter(entry => (entry['VISA '] || '').toLowerCase() === 'ok').length;
            const visaPending = data.filter(entry => (entry['VISA '] || '').toLowerCase() === 'pending').length;
            const visaRejected = data.filter(entry => (entry['VISA '] || '').toLowerCase() === 'rejected').length;
            const visaOther = totalCandidates - visaOk - visaPending - visaRejected;
            
            // Update statistics
            document.getElementById('visaTotalCandidates').textContent = totalCandidates;
            document.getElementById('visaOkCount').textContent = visaOk;
            document.getElementById('visaPendingCount').textContent = visaPending;
            document.getElementById('visaRejectedCount').textContent = visaRejected;
            
            // Create chart
            const chartDiv = document.getElementById('visaStatusChart');
            chartDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: #28a745; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${visaOk}</h3>
                        <p style="margin: 5px 0 0 0;">OK</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #ffc107; color: #333; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${visaPending}</h3>
                        <p style="margin: 5px 0 0 0;">PENDING</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #dc3545; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${visaRejected}</h3>
                        <p style="margin: 5px 0 0 0;">REJECTED</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #6c757d; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${visaOther}</h3>
                        <p style="margin: 5px 0 0 0;">OTHER</p>
                    </div>
                </div>
            `;
        }
        
        // Manpower Status Management Functions
        function loadManpowerData() {
            if (data.length === 0) {
                document.getElementById('manpowerStatusChart').innerHTML = '<p style="text-align: center; color: #666;">No data available</p>';
                return;
            }
            
            const totalCandidates = data.length;
            const manpowerOk = data.filter(entry => (entry[' MAN POWER'] || '').toLowerCase() === 'ok').length;
            const manpowerPending = data.filter(entry => (entry[' MAN POWER'] || '').toLowerCase() === 'pending').length;
            const manpowerRejected = data.filter(entry => (entry[' MAN POWER'] || '').toLowerCase() === 'rejected').length;
            const manpowerOther = totalCandidates - manpowerOk - manpowerPending - manpowerRejected;
            
            // Update statistics
            document.getElementById('manpowerTotalCandidates').textContent = totalCandidates;
            document.getElementById('manpowerOkCount').textContent = manpowerOk;
            document.getElementById('manpowerPendingCount').textContent = manpowerPending;
            document.getElementById('manpowerRejectedCount').textContent = manpowerRejected;
            
            // Create chart
            const chartDiv = document.getElementById('manpowerStatusChart');
            chartDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: #28a745; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${manpowerOk}</h3>
                        <p style="margin: 5px 0 0 0;">OK</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #ffc107; color: #333; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${manpowerPending}</h3>
                        <p style="margin: 5px 0 0 0;">PENDING</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #dc3545; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${manpowerRejected}</h3>
                        <p style="margin: 5px 0 0 0;">REJECTED</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #6c757d; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${manpowerOther}</h3>
                        <p style="margin: 5px 0 0 0;">OTHER</p>
                    </div>
                </div>
            `;
        }
        
        // Flight Status Management Functions
        function loadFlightData() {
            if (data.length === 0) {
                document.getElementById('flightStatusChart').innerHTML = '<p style="text-align: center; color: #666;">No data available</p>';
                return;
            }
            
            const totalCandidates = data.length;
            const flightOk = data.filter(entry => (entry['FLIGHT'] || '').toLowerCase() === 'ok').length;
            const flightPending = data.filter(entry => (entry['FLIGHT'] || '').toLowerCase() === 'pending').length;
            const flightRejected = data.filter(entry => (entry['FLIGHT'] || '').toLowerCase() === 'rejected').length;
            const flightOther = totalCandidates - flightOk - flightPending - flightRejected;
            
            // Update statistics
            document.getElementById('flightTotalCandidates').textContent = totalCandidates;
            document.getElementById('flightOkCount').textContent = flightOk;
            document.getElementById('flightPendingCount').textContent = flightPending;
            document.getElementById('flightRejectedCount').textContent = flightRejected;
            
            // Create chart
            const chartDiv = document.getElementById('flightStatusChart');
            chartDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: #28a745; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${flightOk}</h3>
                        <p style="margin: 5px 0 0 0;">OK</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #ffc107; color: #333; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${flightPending}</h3>
                        <p style="margin: 5px 0 0 0;">PENDING</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #dc3545; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${flightRejected}</h3>
                        <p style="margin: 5px 0 0 0;">REJECTED</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #6c757d; color: white; border-radius: 8px;">
                        <h3 style="margin: 0; font-size: 24px;">${flightOther}</h3>
                        <p style="margin: 5px 0 0 0;">OTHER</p>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>